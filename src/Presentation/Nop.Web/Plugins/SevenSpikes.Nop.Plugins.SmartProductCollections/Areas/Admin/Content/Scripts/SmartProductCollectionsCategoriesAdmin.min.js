!function(t){var e=function(t){var e={groupId:t};return addAntiForgeryToken(e)},a=function(e){var a=t(".tab-builder-title");0===a.children(".tab-category-title").length&&a.append('<span class="tab-category-title"></span>'),a.children(".tab-category-title").text(" ("+e+")")},r=function(r){var o=t(".category-tabs-editor-wrapper"),i=o.children(".category-tabs-editor");i.empty(),o.show().children(".loader").show(),t.ajax({url:t(".category-autocomplete-wrapper").attr("data-getProductsGroupTabsUrl"),type:"POST",data:e(r)}).done(function(e){i.html(e),t.event.trigger({type:"newProductGroupAddedEvent"}),t.event.trigger({type:"initializeCustomCategoryMappingPanel"})}).always(function(){var e=t('.sortable[data-productGroupId="'+r+'"]').children("span:first").text();a(e),o.children(".loader").fadeOut()})};function o(){var e=0,a=t("#store-scope-configuration");if(a.length>0){var r=a.val().split("?")[1];if(null!=r&&null!=(r=r.split("&")[0])){var o=r.split("=");void 0!==o[1]&&"storeid"===o[0].toLowerCase()&&(e=parseInt(o[1]))}}return e}var i=function(t){var e={categoryId:t,storeId:o()};return addAntiForgeryToken(e)},s=function(){var e={categoryGroupIds:t("#CategoryGroupIds").val(),storeId:o()};e=addAntiForgeryToken(e),t.ajax({url:t(".category-autocomplete-wrapper").attr("data-saveCategoryGroupIdsSettingUrl"),type:"POST",data:e})},n=function(){var e="";t(".categories-sortable-list span.sortable[data-categoryid]").each(function(){var a=t(this),r=parseInt(a.attr("data-categoryid"))||0,o=parseInt(a.attr("data-productGroupId"))||0;e+=r+":"+o,a.next("span.sortable[data-categoryid]").length>0&&(e+=",")}),t("#CategoryGroupIds").val(e),s()},c=function(e){var a=t(e),r=parseInt(a.attr("data-categoryId"))||0;!(t('.categories-sortable-list span[data-categoryId="'+r+'"]').length>0)&&(a.addClass("sortable"),a.append('<span class="edit-item-button" title="Edit"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span>'),a.append('<span class="remove-category-item remove-item-button" title="Remove"><i class="fa fa-times" aria-hidden="true"></i></span>'),t.ajax({url:t(".category-autocomplete-wrapper").attr("data-createProductsGroupUrl"),type:"POST",data:i(r)}).done(function(e){t('.categories-sortable-list span[data-categoryId="'+r+'"]').attr("data-productGroupId",e.toString()),t('.categories-sortable-list span[data-productgroupid="'+e+'"] .edit-item-button').click()}).always(function(){n()}),t(".categories-sortable-list").append(a))},l=function(){var e={categoryName:t("#choose-category-autocomplete").val()||""};return addAntiForgeryToken(e)},d=function(e,a){0!==t("#"+e).length&&(t("#"+e).is(":checked")?t(".overlay-for-"+e).remove():t(a).append('<div class="custom-fields-overlay overlay-for-'+e+'"></div>'))},p=function(e,a){var r=t(a);"static"===r.css("position")&&r.css("position","relative"),t("#"+e).change(function(){d(e,a)}),d(e,a)};t(document).ready(function(){t("#choose-category-autocomplete").kendoAutoComplete({dataTextField:"name",filter:"contains",highlightFirst:!0,dataSource:{serverFiltering:!0,transport:{read:{url:t(".category-autocomplete-wrapper").attr("data-getCategoriesUrl"),dataType:"json",data:l}}},template:kendo.template(t("#categoriesSortingTemplate").html()),change:function(e){var a=t("#choose-category-autocomplete_listbox .k-selected > span.k-list-item-text").html();this.value(""),c(a),n()}}),t(".categories-sortable-list").kendoSortable({filter:"span.sortable",container:t(".categories-sortable-list"),hint:function(e){return t('<div class="sortable-categories-drag-drop-hint">'+e.html()+"</div>")},change:n}),t(".categories-sortable-list").on("click",".remove-category-item",function(){var e=t(this).closest(".sortable[data-categoryid]");e.is(".active")&&t(".category-tabs-editor-wrapper").hide(),e.remove(),n()}),t(".categories-sortable-list").on("click",".edit-item-button",function(){var e=t(this).closest(".sortable[data-categoryid]"),a=e.attr("data-productGroupId");e.addClass("active").siblings(".sortable").removeClass("active"),r(a)}),t(".store-scope-configuration .checkbox input").change(function(){p("CategoryGroupIds_OverrideForStore",".choosed-categories-holder")}),p("CategoryGroupIds_OverrideForStore",".choosed-categories-holder")})}(jQuery);