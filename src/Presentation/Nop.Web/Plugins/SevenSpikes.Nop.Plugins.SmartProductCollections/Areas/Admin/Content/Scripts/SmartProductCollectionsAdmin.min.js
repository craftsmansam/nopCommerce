!function(t){var e,a="data-itemId",i=function(){var t=[],e=!0;return{isSaveToPop:function(t){if(void 0===t)return e;e=t,this.next()},push:function(e){t.push(e),this.next()},next:function(){if(e){var a=t.shift();"function"==typeof a&&a()}}}},o=new i,n=new i;function r(){t("html, body").animate({scrollTop:t(".visualized-tabs-wrapper").offset().top-60},700)}var d=function(){var i=t("#tabstrip");0!==i.length&&((e=i.kendoTabStrip({animation:{open:{effects:"fadeIn"}},select:r}).data("kendoTabStrip")).tabGroup.children().length>0&&e.activateTab("li:first"),t("#tabstrip ul.k-tabstrip-items").kendoSortable({filter:"li.k-item:not(.add-new-item-from-tabstrip-button)",axis:"x",container:"ul.k-tabstrip-items",hint:function(e){return t("<div id='sortable-tabs-hint' class='k-widget k-header k-tabstrip'><ul class='k-tabstrip-items k-reset'><li class='k-item k-state-active k-tab-on-top'>"+e.html()+"</li></ul></div>")},start:function(t){e.activateTab(t.item)},change:function(i){var n=e.tabGroup.children().eq(i.newIndex);i.oldIndex<i.newIndex?e.insertAfter(i.item,n):e.insertBefore(i.item,n),o.push(function(){var e=[];t("#tabstrip li.k-item["+a+"]").each(function(){e.push(t(this).attr(a))});var i=t(".categories-sortable-list .sortable.active"),n=addAntiForgeryToken();n.groupId=parseInt(t("#Id").val())||parseInt(i.attr("data-productgroupid"))||0,n.ids=e,o.isSaveToPop(!1),t.ajax({url:t(".visualized-tabs-wrapper").attr("data-reorderGroupItemsUrl"),type:"POST",data:n}).fail(function(t){}).always(function(){o.isSaveToPop(!0)})})}}))},c=function(e){var i=t("#tabstrip li["+a+'="'+e+'"]').attr("aria-controls"),o=t("#"+i);o.find(".found-products-grid .loader").show();var n=addAntiForgeryToken();n.id=e,t.ajax({url:t(".visualized-tabs-wrapper").attr("data-getProductsForSourceTypeUrl"),type:"POST",data:n}).done(function(e){o.find(".found-products-grid .products-grid").html(e),("70"===o.find("select.itemSourceType").val()||o.find("input.category-custom-collection").is(":checked"))&&t(".visualized-tabs-wrapper").trigger("customListProductsLoaded",{tabContent:o})}).always(function(){o.find(".found-products-grid .loader").hide(),t(".products-vary-by-acl-message").removeClass("hidden")})},s=function(e){var a=t(".visualized-tabs-wrapper"),i=e.closest(".tab-content.k-content"),o=parseInt(e.val()),n=addAntiForgeryToken(),r=parseInt(i.find(".group-item-id").val())||0,d=t('#tabstrip .tabs-anchors li[aria-controls="'+i.attr("id")+'"]');if(n.itemId=r,n.sourceType=o,i.find(".custom-item-content, .found-products-grid .products-grid, .custom-list-add-products").empty(),0===o){var s=a.attr("data-defaultItemTitle")||"<No Title>";d.find(".k-link").text(s);return}t.ajax({url:a.attr("data-sourceTypeChangeUrl"),type:"POST",data:n}).done(function(e){var n=i.find(".custom-item-content");n.html(e),i.find(".custom-list-add-products").empty();var s=n.find('.group-item-title[name="Title"]').val();s&&d.find(".k-link").text(s),(10===o||20===o||30===o||35===o||70===o)&&c(r),a.on("change",".itemEntityId, .itemSortMethod",function(){l(t(this))})})},l=function(e){var a=t(".visualized-tabs-wrapper"),i=e.closest(".tab-content.k-content"),o=t('#tabstrip .tabs-anchors li[aria-controls="'+i.attr("id")+'"]'),n=parseInt(i.find(".group-item-id").val())||0,r=parseInt(i.find("select.itemEntityId").val())||0,d=parseInt(i.find("select.itemSortMethod").val())||0;if(0===r){i.find(".found-products-grid .products-grid").empty();return}var s=addAntiForgeryToken();s.Id=n,s.EntityId=r,s.SortMethod=d,t.ajax({url:a.attr("data-entityOrSortMethodChangeUrl"),type:"POST",data:s}).done(function(t){var e=t.title||a.attr("data-defaultItemTitle")||"<No Title>";o.find(".k-link").text(e),t.title&&i.find('[name="Title"]').val(t.title),c(n)})},u=function(e){var a=e.closest(".tab-content.k-content"),i=e.closest("form"),o=i.attr("action"),n=i.attr("method"),r=parseInt(a.find(".group-item-id").val())||0;if(!isNaN(r)&&0!==r){var d=i.serialize();d+="&save=save",t.ajax({url:o,type:n,data:d}).done(function(){i.find(".homepage-products-mappings-grid").DataTable().ajax.reload(),c(r)})}},p=function(t){t.closest(".tab-content.k-content").find('.found-products-grid .item-box[data-productId="'+t.val()+'"] .remove-button').click()},f=function(){var i=t(".visualized-tabs-wrapper");d(),t(".add-new-group-item-button, .add-new-item-from-tabstrip-button").off("click"),i.off("change",".itemSourceType"),i.off("click",".remove-item"),i.off("change",".group-item-title"),i.off("change",".group-item-active-input"),i.off("change",".itemEntityId, .itemSortMethod"),i.off("click",'.custom-list-add-products .homepage-products-mappings-grid input[type="checkbox"]'),i.off("click",".found-products-grid .item-box .remove-button"),i.off("customListProductsLoaded"),t("#Store").off("change"),t(".add-new-group-item-button, .add-new-item-from-tabstrip-button").on("click",function(o){o.preventDefault(),e.disable(t(".add-new-item-from-tabstrip-button"));var n=t(".categories-sortable-list .sortable.active"),d=addAntiForgeryToken();d.groupId=parseInt(t("#Id").val())||parseInt(n.attr("data-productgroupid"))||0,d.categoryId=parseInt(n.attr("data-categoryid"))||0,t.ajax({url:i.attr("data-createGroupItemUrl"),type:"POST",data:d}).done(function(o){var n=t(o),d=n.find(".group-item-id"),c=d.val();if(void 0!=c){t(".add-new-group-item-button").addClass("hidden"),t(".no-product-items-available").addClass("hidden");var u=t(".add-new-item-from-tabstrip-button"),p=t(".add-new-item-tabstrip-content");t("#tabstrip").show().find(p).before(n),e.insertBefore({text:d.attr("data-defaultTitle")},u);var f=u.prev();f.attr(a,c),e.activateTab(f),e.tabGroup.children().length>2&&t(".drag-and-drop-items-info").removeClass("hidden"),r(),i.on("change",".itemEntityId, .itemSortMethod",function(){l(t(this))}),i.on("change",".itemSourceType",function(){s(t(this))}),e.enable(t(".add-new-item-from-tabstrip-button"))}})}),i.on("click",".remove-item",function(o){o.preventDefault();var n=t(this),r=parseInt(n.attr(a));if(!isNaN(r)&&0!==r){if(!1!==confirm("Are you sure ?")){var d=addAntiForgeryToken();d.id=r,t.ajax({url:i.attr("data-deleteGroupItemUrl"),type:"POST",data:d}).done(function(){var i=t("#tabstrip li").filter("["+a+'="'+r+'"]');e.remove(i),1===e.tabGroup.children().length?(t("#tabstrip").hide(),t(".add-new-group-item-button").removeClass("hidden"),t(".no-product-items-available").removeClass("hidden"),t(".products-vary-by-acl-message").addClass("hidden")):i.is(".k-state-active")&&e.activateTab("li:first"),e.tabGroup.children().length<=2&&t(".drag-and-drop-items-info").addClass("hidden")})}}}),i.on("change",".group-item-title",function(){var e=t(this),o=e.val(),n=e.closest(".tab-content.k-content"),r=t('#tabstrip .tabs-anchors li[aria-controls="'+n.attr("id")+'"]'),d=n.find(".group-item-title"),c=n.find('input[name$="LanguageId"]'),s=addAntiForgeryToken();s.Id=parseInt(r.attr(a))||0,s.Title=d.filter('[name="Title"]').val(),d.each(function(){var e=t(this);s[e.attr("name")]=e.val()}),c.each(function(){var e=t(this);s[e.attr("name")]=e.val()}),""!==o&&r.find(".k-link").text(o),t.ajax({url:i.attr("data-titleChangeUrl"),type:"POST",data:s}).done(function(t){d.filter('[name="Title"]').val(t.title),r.find(".k-link").text(t.title)})}),i.on("change",".group-item-active-input",function(){var e=t(this),o=addAntiForgeryToken();o.Id=parseInt(e.attr(a))||0,o.Active=e.is(":checked"),t.ajax({url:i.attr("data-activeChangeUrl"),type:"POST",data:o})}),i.on("change",".category-custom-collection",function(){var e=t(this),o=addAntiForgeryToken(),n=parseInt(e.attr(a));o.Id=n||0,o.EnableCategoryCustomCollection=e.is(":checked");var r=e.closest(".tab-content.k-content");t.ajax({url:i.attr("data-enablecategorycustomcollectionurl"),type:"POST",data:o}).done(function(a){r.find(".custom-item-content").html(a),r.find(".custom-list-add-products").empty(),i.on("change",".itemEntityId, .itemSortMethod",function(){l(t(this))}),e.is(":checked")&&t.event.trigger({type:"initializeCustomCategoryMappingPanel"}),c(n)})}),i.on("change",".itemEntityId, .itemSortMethod",function(){l(t(this))}),i.on("change",".itemSourceType",function(){s(t(this))}),i.on("click",'.custom-list-add-products [id^="products-grid-"] input[type="checkbox"]',function(){var e=t(this);e.is(":checked")?u(e):p(e)}),i.on("click",".found-products-grid .item-box .remove-button",function(){var e=t(this),a=e.closest(".tab-content.k-content"),o=parseInt(a.find(".group-item-id").val())||0,n=e.closest(".item-box"),r=parseInt(n.attr("data-productId"))||0;if(!(isNaN(o)||0===o||isNaN(r))&&0!==r){var d=addAntiForgeryToken();d.id=o,d.productId=r,t.ajax({url:i.attr("data-deleteProductFromCustomListUrl"),type:"POST",data:d}).done(function(){n.remove(),a.find(".homepage-products-mappings-grid").DataTable().ajax.reload(),c(o)})}}),i.on("customListProductsLoaded",function(e,a){var o=a.tabContent;if(void 0!=o&&0!==o.length&&("70"===o.find("select.itemSourceType").val()||o.find("input.category-custom-collection").is(":checked"))){var r=o.find(".found-products-grid .products-grid");r.hasClass("sortable-grid")&&r.kendoSortable("destroy"),r.addClass("sortable-grid");var d=r.children(".item-box");d.addClass("sortable removable"),d.prepend('<div class="remove-button">remove</div>'),o.find(".drag-and-drop-products-info").toggleClass("hidden",d.length<2),r.kendoSortable({filter:".item-box.sortable",container:r,hint:function(t){return t.clone().addClass("hint")},placeholder:function(){return'<div class="item-box sortable placeholder"><span>Drag and drop your product here</span></div>'},change:function(){n.push(function(){var e=[];o.find(".products-grid.sortable-grid .item-box.sortable").each(function(){e.push(t(this).attr("data-productId"))});var a=addAntiForgeryToken();a.itemId=parseInt(o.find(".group-item-id").val())||0,a.productIds=e,n.isSaveToPop(!1),t.ajax({url:i.attr("data-reorderProductsInCustomListUrl"),type:"POST",data:a}).fail(function(){}).always(function(){n.isSaveToPop(!0)})})}})}}),t("#Store").on("change",function(){var e=t(this).val();t(".searchStoreId").each(function(){var a=t(this);a.val(e),u(a)})}),t(".products-vary-by-acl-message").each(function(){var e=t(this);e.closest(".tab-content").find(".products-grid .item-box").length>0&&e.removeClass("hidden")})};t(document).ready(function(){var e,a,i,o;f(),t(document).on("newProductGroupAddedEvent",f),e=t("#NumberOfProductsPerItem"),a=t("#NumberOfProducts"),o=parseInt((i=e.length?e:a).val())+1,t("head").append("<style> .products-grid .sortable:nth-child(n+"+o+") { opacity: 0.2; } </style>")})}(jQuery);